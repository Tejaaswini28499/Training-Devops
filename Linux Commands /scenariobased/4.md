Alright! Let’s break it down step by step so it’s super clear. Limiting a user’s CPU usage in Linux can be done in **multiple ways**, mainly using `nice`, `cpulimit`, and **cgroups**. I’ll explain all three.

---

## **1. Using `nice` and `renice`**

Linux allows you to **adjust the priority** of a process. Lower priority processes get less CPU time.

* **`nice`**: Start a process with a lower priority.
* **`renice`**: Change priority of an already running process.

**Syntax**:

```bash
nice -n <priority> <command>
```

* `priority` ranges from `-20` (highest priority) to `19` (lowest priority).
* Example: Run a CPU-heavy script with low priority:

```bash
nice -n 10 python myscript.py
```

* **To change a running process**:

```bash
renice 15 -p 1234
```

`1234` is the PID of the process.

> **Note:** This doesn’t strictly limit CPU usage but reduces how aggressively the process competes for CPU.

---

## **2. Using `cpulimit`**

`cpulimit` can **directly limit the CPU usage** of a process in percentage.

**Install** (on Ubuntu/Debian):

```bash
sudo apt install cpulimit
```

**Usage**:

```bash
cpulimit -p 1234 -l 30
```

* `1234` → PID of the process
* `30` → maximum CPU usage percentage

**Or start a process with a limit:**

```bash
cpulimit -l 20 -- python myscript.py
```

This will make sure the process **never uses more than 20% CPU**.

---

## **3. Using cgroups (Control Groups)**

This is more **powerful and permanent**, useful for servers with multiple users.

* **cgroups** let you limit **CPU, memory, I/O** per user, process, or group of processes.

**Steps**:

1. **Create a cgroup**:

```bash
sudo cgcreate -g cpu:/limited_user
```

2. **Set CPU limit**:

```bash
# Limit to 50% of one CPU
sudo cgset -r cpu.cfs_quota_us=50000 limited_user
sudo cgset -r cpu.cfs_period_us=100000 limited_user
```

* `cpu.cfs_quota_us / cpu.cfs_period_us` = max CPU usage.
* `50000 / 100000` = 50% CPU.

3. **Add a user’s process to cgroup**:

```bash
sudo cgclassify -g cpu:/limited_user <PID>
```

**Or make all processes of a user run in the cgroup**:

* Using systemd:

```bash
sudo systemctl set-property user-1000 CPUQuota=50%
```

Here, `user-1000` is the systemd slice for that user.

> ✅ This method is **robust** for servers and production environments.

---

### **Summary**

| Method          | What it does                    | Best for                        |
| --------------- | ------------------------------- | ------------------------------- |
| `nice`/`renice` | Adjust process priority         | Light CPU control, per-process  |
| `cpulimit`      | Limit CPU % per process         | Quick & simple, per-process     |
| cgroups         | Hard CPU limit per user/process | Production-grade, multi-process |

---

If you want, I can give you a **step-by-step example where we limit a user to 30% CPU permanently using cgroups**, which is what most DevOps engineers do in real life.

Do you want me to do that?
